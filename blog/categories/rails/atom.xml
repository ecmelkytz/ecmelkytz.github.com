<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: rails, | Ecmel Kaytazoğlu]]></title>
  <link href="http://ecmelkytz.github.com/blog/categories/rails/atom.xml" rel="self"/>
  <link href="http://ecmelkytz.github.com/"/>
  <updated>2016-04-27T13:42:26+03:00</updated>
  <id>http://ecmelkytz.github.com/</id>
  <author>
    <name><![CDATA[Ecmel Kaytazoğlu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails: AngularJS ile CRUD İşlemleri]]></title>
    <link href="http://ecmelkytz.github.com/blog/2015/09/19/rails-angularjs-ile-crud-islemleri/"/>
    <updated>2015-09-19T15:40:24+03:00</updated>
    <id>http://ecmelkytz.github.com/blog/2015/09/19/rails-angularjs-ile-crud-islemleri</id>
    <content type="html"><![CDATA[<p>Bu yazı Rails&#8217;de CRUD (Create, Read, Update, Delete) işlemlerinin AngularJS ile nasıl yapılabileceğini açıklamaktadır.</p>

<p>AngularJS&#8217;nin ngResource modülü kullanılmıştır. ngResurce modülü $resource servisi üzerinden RESTful servislerle etkileşimde bulunabilmeyi sağlar.</p>

<p>Book adında bir model oluşturalım, <code>angularjs-rails</code> gem&#8217;ini ekleyelim ve routes&#8217;u ayarlayalım.</p>

<p><figure class='code'><figcaption><span>Terminal </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">scaffold</span> <span class="no">Book</span> <span class="n">title</span> <span class="ss">like</span><span class="p">:</span><span class="n">integer</span>
</span><span class='line'><span class="err">$</span> <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>Gemfile </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">angularjs</span><span class="o">-</span><span class="n">rails</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>assets/javascripts/application.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">//= require angular</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>routes.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">resources</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span><span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span><span class="p">}</span>
</span><span class='line'><span class="n">root</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">books</span><span class="c1">#index&amp;rdquo;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Gelelim işin Angular kısmına:</p>

<p><strong>Hatırlatma:</strong> Herşeyden önce <a href="https://code.angularjs.org/1.3.9/angular-resource.js">angular-resource.js</a> dosyasını projemize eklemeliyiz. İster cdn olarak isterseniz de assets dizinine ekleyebilirsiniz.</p>

<p><figure class='code'><figcaption><span>layouts/application.html.erb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="sx">%= javascript_include_tag &amp;ldquo;&lt;a href=</span><span class="s2">&quot;https://ajax.googleapis.com/ajax/libs/angularjs/1.3.9/angular-resource.min.js&quot;</span><span class="o">&gt;</span><span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">ajax</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ajax</span><span class="o">/</span><span class="n">libs</span><span class="o">/</span><span class="n">angularjs</span><span class="o">/</span><span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">9</span><span class="o">/</span><span class="n">angular</span><span class="o">-</span><span class="n">resource</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">js</span><span class="o">&lt;</span><span class="sr">/a&gt;&amp;rdquo; %&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>javascripts/angular/app.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">bookApp</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span> <span class="p">[</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">ngResource</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;]);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><code>bookApp</code> adında bir module tanımladık ve ngResource modülünü dependency olarak belirttik.</p>

<p>Angular uygulaması başlaması için <code>ng-app</code> directive&#8217;ini layout&#8217;a ekleyelim.</p>

<p><figure class='code'><figcaption><span>views/layout/index.html.erb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;html</span> <span class="na">ng-app=</span><span class="s">&quot;bookApp&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="ni">&amp;hellip;</span>
</span><span class='line'>  <span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Şimdi de Book verileri üzerinde crud işlemleri yapabilmek için Angularjs&#8217;in servis oluşturma komponentlerinden biri olan factory ile bir servis oluşturalım.</p>

<p><figure class='code'><figcaption><span>javascripts/angular/app.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">Book</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="sr">/books/</span><span class="o">:</span><span class="nx">id</span><span class="p">.</span><span class="nx">json</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="err">@</span><span class="nx">id</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;</span> <span class="p">},</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>        <span class="nx">create</span><span class="o">:</span>  <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">POST</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="p">},</span>
</span><span class='line'>        <span class="nx">index</span><span class="o">:</span>   <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">GET</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="nx">isArray</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
</span><span class='line'>        <span class="nx">get</span><span class="o">:</span>    <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">GET</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="nx">isArray</span><span class="o">:</span> <span class="kc">false</span> <span class="p">},</span>
</span><span class='line'>        <span class="nx">update</span><span class="o">:</span>  <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">PUT</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="p">},</span>
</span><span class='line'>        <span class="nx">destroy</span><span class="o">:</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">DELETE</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><code>Book</code> adında bir servis oluşturduk. Bu servisi kullanacağımız controller&#8217;a dependency olarak aşağıdaki gibi belirteceğiz.</p>

<p><figure class='code'><figcaption><span>javascripts/angular/controllers.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">BookCtrl</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">$scope</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">Book</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">Book</span><span class="p">)]);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Yukarıdaki kodun açılımı şudur: <code>bookApp</code> modülüne (app) <code>BookCtrl</code> adında bir controller tanımladık ve bu controller&#8217;a oluşturduğumuz <code>Book</code> servisini dependency olarak belirttik. Yani servisimizde tanımladığımız fonksiyonları bu controller içerisinde artık kullanabileceğiz.</p>

<p>Oluşturduğumuz controller&#8217;ı hangi directive kapsamında çalışmasını istiyorsak orada tanımlıyoruz. İster <code>body</code>&lsquo;de tanımlayın, isterseniz kapsamını azaltmak için başka bir directive&#8217;e tanımlayın. Ben bu örnekte ilgili sayfanın index&#8217;ine tanımlayacağım.</p>

<p><figure class='code'><figcaption><span>views/books/index.html.erb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span> <span class="na">ng-controller=</span><span class="s">&quot;BookCtrl&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-6 col-md-offset-3&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;center&gt;&lt;h1&gt;</span>Books<span class="nt">&lt;/h1&gt;&lt;/center&gt;</span>
</span><span class='line'>    <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">&quot;form-horizontal&quot;</span> <span class="na">ng-submit=</span><span class="s">&quot;addBook()&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;input-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;book_title&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;input-group-btn&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-default&quot;</span> <span class="na">value=</span><span class="s">&quot;Ekle&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/span&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;table table-striped table-condensed&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;thead&gt;</span>
</span><span class='line'>            <span class="nt">&lt;tr&gt;</span>
</span><span class='line'>              <span class="nt">&lt;th&gt;</span>Başlık<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>              <span class="nt">&lt;th&gt;</span>Like<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>          <span class="nt">&lt;th</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>İşlemler<span class="nt">&lt;/th&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/thead&gt;</span>
</span><span class='line'>          <span class="nt">&lt;tbody&gt;</span>
</span><span class='line'>              <span class="nt">&lt;tr</span> <span class="na">ng-repeat=</span><span class="s">&quot;book in books&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td&gt;</span><span class="err">&lt;</span>%= link_to &quot;&quot;, book_path(&quot;&quot;) %&gt;<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
</span><span class='line'>          <span class="nt">&lt;td&gt;</span>
</span><span class='line'>            <span class="err">&lt;</span>%= link_to &quot;Like&quot;, &#39;&#39;, &#39;ng-click&#39; =&gt; <span class="ni">&amp;#8220;</span>likeBook($index)<span class="ni">&amp;#8221;</span>, value:<span class="ni">&amp;#8221;</span>like<span class="ni">&amp;#8221;</span>, class:<span class="ni">&amp;#8221;</span>btn btn-success btn-xs<span class="ni">&amp;#8221;</span> %&gt;
</span><span class='line'>            <span class="err">&lt;</span>%= link_to &quot;Dislike&quot;, &#39;&#39;, &#39;ng-click&#39; =&gt; <span class="ni">&amp;#8220;</span>dislikeBook($index)<span class="ni">&amp;#8221;</span>, value:<span class="ni">&amp;#8221;</span>dislike<span class="ni">&amp;#8221;</span>, class:<span class="ni">&amp;#8221;</span>btn btn-danger btn-xs<span class="ni">&amp;#8221;</span> %&gt;
</span><span class='line'>            <span class="err">&lt;</span>%= link_to &quot;Remove&quot;, &#39;&#39;,&#39;ng-click&#39; =&gt; <span class="ni">&amp;#8220;</span>deleteBook($index)<span class="ni">&amp;#8221;</span>, value:<span class="ni">&amp;#8221;</span>remove<span class="ni">&amp;#8221;</span>, class:<span class="ni">&amp;#8221;</span>btn btn-warning btn-xs<span class="ni">&amp;#8221;</span> %&gt;
</span><span class='line'>          <span class="nt">&lt;/td&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/tbody&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/table&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Görüldüğü gibi <code>BookCtrl</code> controller en baştaki tag&#8217;da tanımlı ve ben bu tag&#8217;lar arasında controller içerisinde tanımladığım bütün fonksiyonları kullanabileceğim.</p>

<h4>Read İşlemi</h4>

<p>Tanımlı book nesnelerini elde etmek için <code>Book</code> servisimizdeki <em>index</em> metodundan yararlanacağız.</p>

<p><figure class='code'><figcaption><span>javascripts/angular/controllers.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">BookCtrl</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">$scope</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">Book</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">Book</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span> <span class="o">=</span> <span class="nx">Book</span><span class="p">.</span><span class="nx">index</span><span class="p">();</span>
</span><span class='line'><span class="p">}]);</span>
</span></code></pre></td></tr></table></div></figure></p>

<h4>Create İşlemi</h4>

<p>İndex sayfası içerisindeki <code>ng-submit="addBook()"</code> ve <code>ng-model="book_title"</code> yeni bir book nesnesi oluşturmakta bize yardımcı olacak.
İnput&#8217;a tanımlanan ng-model&#8217;in <code>book_title</code> değişkeni $scope&#8217;a bağlanacaktır. Submit ederken <code>addBook()</code> fonksiyonu çalışacaktır. Şimdi bu fonksiyonu controller&#8217;ımıza tanımlayalım.</p>

<p><figure class='code'><figcaption><span>javascripts/angular/controllers.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">BookCtrl</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">$scope</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">Book</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">Book</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">addBook</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">attr</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>    <span class="nx">attr</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">book_title</span><span class="p">;</span> <span class="c1">// ng-model&amp;#8217;deki veri</span>
</span><span class='line'>    <span class="nx">attr</span><span class="p">.</span><span class="nx">like</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Yeni oluşturulan verinin like değeri</span>
</span><span class='line'>    <span class="nx">newBook</span> <span class="o">=</span> <span class="nx">Book</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">attr</span><span class="p">);</span> <span class="c1">// Create işlemi burada</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newBook</span><span class="p">);</span> <span class="c1">// View kısmını refresh etmeden verileri göstermek için books değişkenine veriyi ekliyoruz</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">book_title</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;;</span> <span class="c1">// Nesneyi ekledikten sonra input&amp;#8217;taki veriyi siler</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}]);</span>
</span></code></pre></td></tr></table></div></figure></p>

<h4>Update İşlemi</h4>

<p>Güncelleme işlemi için kullanılacak satır:</p>

<p><figure class='code'><figcaption><span>views/books/index.html.erb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="sx">%= link_to &amp;ldquo;Like&amp;rdquo;, &amp;lsquo;&amp;rsquo;, &amp;lsquo;ng-click&amp;rsquo; =</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">likeBook</span><span class="p">(</span><span class="vg">$index</span><span class="p">)</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="ss">value</span><span class="p">:</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">like</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="ss">class</span><span class="p">:</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">btn</span> <span class="n">btn</span><span class="o">-</span><span class="n">success</span> <span class="n">btn</span><span class="o">-</span><span class="n">xs</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Butona basılınca <code>likeBook()</code> fonksiyonu çalışacak. O halde <code>likeBook()</code> fonksiyonunu tanımlayalım.
<figure class='code'><figcaption><span>javascripts/angular/controllers.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">BookCtrl</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">$scope</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">Book</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">Book</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">likeBook</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">book</span> <span class="o">=</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">book</span><span class="p">.</span><span class="nx">like</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">Book</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">book</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">like</span><span class="o">:</span> <span class="nx">book</span><span class="p">.</span><span class="nx">like</span><span class="p">});</span> <span class="c1">// Update işlemi burada</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}]);</span>
</span></code></pre></td></tr></table></div></figure></p>

<h4>Delete İşlemi</h4>

<p>Silme işlemi için kullanılacak satır:
<figure class='code'><figcaption><span>views/books/index.html.erb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="sx">%= link_to &amp;ldquo;Remove&amp;rdquo;, &amp;lsquo;&amp;rsquo;,&amp;lsquo;ng-click&amp;rsquo; =</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">deleteBook</span><span class="p">(</span><span class="vg">$index</span><span class="p">)</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="ss">value</span><span class="p">:</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">remove</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="ss">class</span><span class="p">:</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">btn</span> <span class="n">btn</span><span class="o">-</span><span class="n">warning</span> <span class="n">btn</span><span class="o">-</span><span class="n">xs</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><code>deleteBook()</code> fonksiyonunu tanımlayalım.</p>

<p><figure class='code'><figcaption><span>javascripts/angular/controllers.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">BookCtrl</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">$scope</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">Book</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">Book</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">deleteBook</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">book</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">Book</span><span class="p">.</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">book</span><span class="p">);</span> <span class="c1">// Delete işlemi burada</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>  <span class="c1">// View kısmını güncellemek için belirtilen indexten itibaren 1 nesne siler.</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}]);</span>
</span></code></pre></td></tr></table></div></figure></p>

<h4>422 (Unprocessable Entity) hatasından kurtulmak için:</h4>

<p><figure class='code'><figcaption><span>controllers/application_controller.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">skip_before_action</span> <span class="ss">:verify_authenticity_token</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="ss">:json_request?</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;protected&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">json_request?</span>
</span><span class='line'>  <span class="n">request</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">json?</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p style="text-align:center;"><strong>TL;DR</strong></p>

<p>Look at the my github repo => <a href="https://github.com/ecmelkytz/rails-angular-resource">https://github.com/ecmelkytz/rails-angular-resource</a></p>
]]></content>
  </entry>
  
</feed>
